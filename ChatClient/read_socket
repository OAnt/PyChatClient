import gevent
import gevent.socket
import sys
from gevent import select

Socket = gevent.socket.create_connection(("localhost", 4000))


def listen_connection(Socket):
    sys.stdout.write(Socket.recv(1024))
    sys.stdout.flush()


def write_connection(a_pipe):
    line = a_pipe.readline()
    Socket.sendall(line)


def scheduler():
    dispatcher = {sys.stdin: write_connection, Socket: listen_connection}
    while True:
        to_read, to_write, to_err = select.select([Socket, sys.stdin],[],[],1)
        for input in to_read:
            dispatcher[input](input)


gevent.joinall([
    gevent.spawn(scheduler)
    ])
